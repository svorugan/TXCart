<mat-card>
  <mat-toolbar color="primary">Doctor Management</mat-toolbar>

  <form class="search-form" (ngSubmit)="applyFilters()" style="display: flex; flex-wrap: wrap; gap: 1rem; align-items: flex-end;">
    <mat-form-field appearance="outline">
      <mat-label>Name</mat-label>
      <input matInput [(ngModel)]="searchName" name="searchName">
      <mat-icon matSuffix>person</mat-icon>
    </mat-form-field>
    <mat-form-field appearance="outline">
      <mat-label>Years Experience</mat-label>
      <input matInput type="number" [(ngModel)]="searchYearsExperience" name="searchYearsExperience">
      <mat-icon matSuffix>history</mat-icon>
    </mat-form-field>
    <mat-form-field appearance="outline">
      <mat-label>City</mat-label>
      <input matInput [(ngModel)]="searchCity" name="searchCity">
      <mat-icon matSuffix>location_city</mat-icon>
    </mat-form-field>
    <mat-form-field appearance="outline">
      <mat-label>Specialty</mat-label>
      <mat-select [(ngModel)]="searchSpecialty" name="searchSpecialty">
        <mat-option value="">All</mat-option>
        <mat-option *ngFor="let s of specialties" [value]="s">{{s}}</mat-option>
      </mat-select>
      <mat-icon matSuffix>medical_services</mat-icon>
    </mat-form-field>
    <mat-form-field appearance="outline">
      <mat-label>State</mat-label>
      <mat-select [(ngModel)]="searchState" name="searchState">
        <mat-option value="">All</mat-option>
        <mat-option *ngFor="let state of states" [value]="state">{{state}}</mat-option>
      </mat-select>
      <mat-icon matSuffix>map</mat-icon>
    </mat-form-field>
    <div style="min-width: 180px; display: flex; flex-direction: column; align-items: start;">
      <label style="font-size: 12px; color: #666; margin-bottom: 4px;">Patient Rating</label>
      <mat-slider min="0" max="5" step="0.5" style="width: 140px;">
        <input matSliderThumb [(ngModel)]="searchPatientRating" name="searchPatientRating" />
      </mat-slider>
      <span style="font-size: 12px; color: #888;">{{searchPatientRating || 0}}</span>
    </div>

    <button mat-raised-button color="primary" type="submit" style="margin-right: 8px;">
      <mat-icon>search</mat-icon> Search
    </button>
    <button mat-raised-button color="accent" type="button" routerLink="/doctors/create">
      <mat-icon>person_add</mat-icon> Create New Doctor
    </button>
  </form>

  <div class="filter-tags" style="margin-top: 1rem; display: flex; flex-wrap: wrap; gap: 0.5rem;">
    <div *ngIf="hasActiveFilters()" style="margin-right: 0.5rem; font-weight: 500;">Active filters:</div>
    <mat-chip *ngIf="searchName" (removed)="clearFilter('name')">Name: {{searchName}}<mat-icon matChipRemove>cancel</mat-icon></mat-chip>
    <mat-chip *ngIf="searchYearsExperience !== null" (removed)="clearFilter('yearsExperience')">Experience: {{searchYearsExperience}} years<mat-icon matChipRemove>cancel</mat-icon></mat-chip>
    <mat-chip *ngIf="searchCity" (removed)="clearFilter('city')">City: {{searchCity}}<mat-icon matChipRemove>cancel</mat-icon></mat-chip>
    <mat-chip *ngIf="searchState" (removed)="clearFilter('state')">State: {{searchState}}<mat-icon matChipRemove>cancel</mat-icon></mat-chip>
    <mat-chip *ngIf="searchSpecialty" (removed)="clearFilter('specialty')">Specialty: {{searchSpecialty}}<mat-icon matChipRemove>cancel</mat-icon></mat-chip>
    <mat-chip *ngIf="searchPatientRating !== null" (removed)="clearFilter('patientRating')">Rating: {{searchPatientRating}}<mat-icon matChipRemove>cancel</mat-icon></mat-chip>
    <button *ngIf="hasActiveFilters()" mat-stroked-button color="warn" (click)="clearAllFilters()" style="height: 32px; line-height: 32px;">
      <mat-icon style="font-size: 16px; height: 16px; width: 16px;">clear_all</mat-icon> Clear All
    </button>
  </div>

  <mat-table [dataSource]="filteredDoctors" class="mat-elevation-z8">
    <ng-container matColumnDef="id">
      <mat-header-cell *matHeaderCellDef> ID </mat-header-cell>
      <mat-cell *matCellDef="let doctor"> {{doctor.id}} </mat-cell>
    </ng-container>


    <ng-container matColumnDef="actions">
  <mat-header-cell *matHeaderCellDef> Actions </mat-header-cell>
  <mat-cell *matCellDef="let row">
    <ng-container *ngIf="editingDoctorId === row.id; else viewActions">
      <button mat-icon-button color="primary" (click)="saveEdit()"><mat-icon>save</mat-icon></button>
      <button mat-icon-button color="warn" (click)="cancelEdit()"><mat-icon>cancel</mat-icon></button>
    </ng-container>
    <ng-template #viewActions>
      <button mat-icon-button color="primary" [routerLink]="['/doctors/edit', row.id]"><mat-icon>edit</mat-icon></button>
      <button mat-icon-button color="warn" (click)="deleteDoctor(row.id)"><mat-icon>delete</mat-icon></button>
    </ng-template>
  </mat-cell>
</ng-container>

<mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></mat-header-row>
<!-- Only one definition per column. If you see this block twice, remove the duplicate below. -->
<ng-container matColumnDef="name">
  <mat-header-cell *matHeaderCellDef> Name </mat-header-cell>
  <mat-cell *matCellDef="let row">
    <ng-container *ngIf="editingDoctorId === row.id; else viewName">
      <mat-form-field appearance="outline"><input matInput [(ngModel)]="editDoctor!.name" name="editDoctorName"></mat-form-field>
    </ng-container>
    <ng-template #viewName>{{row.name}}</ng-template>
  </mat-cell>
</ng-container>
<ng-container matColumnDef="specialty">
  <mat-header-cell *matHeaderCellDef> Specialty </mat-header-cell>
  <mat-cell *matCellDef="let row">
    <ng-container *ngIf="editingDoctorId === row.id; else viewSpecialty">
      <mat-form-field appearance="outline"><mat-select [(ngModel)]="editDoctor!.specialty" name="editDoctorSpecialty"><mat-option *ngFor="let s of specialties" [value]="s">{{s}}</mat-option></mat-select></mat-form-field>
    </ng-container>
    <ng-template #viewSpecialty>{{row.specialty}}</ng-template>
  </mat-cell>
</ng-container>
<ng-container matColumnDef="yearsExperience">
  <mat-header-cell *matHeaderCellDef> Years Exp </mat-header-cell>
  <mat-cell *matCellDef="let row">
    <ng-container *ngIf="editingDoctorId === row.id; else viewYears">
      <mat-form-field appearance="outline"><input matInput type="number" [(ngModel)]="editDoctor!.yearsExperience" name="editDoctorYearsExperience"></mat-form-field>
    </ng-container>
    <ng-template #viewYears>{{row.yearsExperience}}</ng-template>
  </mat-cell>
</ng-container>
<ng-container matColumnDef="city">
  <mat-header-cell *matHeaderCellDef> City </mat-header-cell>
  <mat-cell *matCellDef="let row">
    <ng-container *ngIf="editingDoctorId === row.id; else viewCity">
      <mat-form-field appearance="outline"><input matInput [(ngModel)]="editDoctor!.city" name="editDoctorCity"></mat-form-field>
    </ng-container>
    <ng-template #viewCity>{{row.city}}</ng-template>
  </mat-cell>
</ng-container>
<ng-container matColumnDef="state">
  <mat-header-cell *matHeaderCellDef> State </mat-header-cell>
  <mat-cell *matCellDef="let row">
    <ng-container *ngIf="editingDoctorId === row.id; else viewState">
      <mat-form-field appearance="outline"><mat-select [(ngModel)]="editDoctor!.state" name="editDoctorState"><mat-option *ngFor="let state of states" [value]="state">{{state}}</mat-option></mat-select></mat-form-field>
    </ng-container>
    <ng-template #viewState>{{row.state}}</ng-template>
  </mat-cell>
</ng-container>
<ng-container matColumnDef="patientRating">
  <mat-header-cell *matHeaderCellDef> Rating </mat-header-cell>
  <mat-cell *matCellDef="let row">
    <ng-container *ngIf="editingDoctorId === row.id; else viewRating">
      <div style="min-width: 120px;"><mat-slider min="0" max="5" step="0.5" style="width: 90px;"><input matSliderThumb [(ngModel)]="editDoctor!.patientRating" name="editDoctorPatientRating" /></mat-slider><span style="font-size: 12px; color: #888;">{{editDoctor?.patientRating || 0}}</span></div>
    </ng-container>
    <ng-template #viewRating>{{row.patientRating}}</ng-template>
  </mat-cell>
</ng-container>
<!-- actions column already present above -->

<mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
  </mat-table>
</mat-card>