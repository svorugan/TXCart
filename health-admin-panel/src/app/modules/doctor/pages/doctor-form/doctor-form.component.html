<div class="doctor-form-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>{{ isEditMode ? 'Edit Doctor Profile' : 'Create New Doctor Profile' }}</mat-card-title>
      <mat-card-subtitle>Enter doctor details including all filter criteria for patient search</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="doctorForm" (ngSubmit)="onSubmit()">
        <mat-tab-group>
          <!-- Basic Information Tab -->
          <mat-tab label="Basic Information">
            <div class="tab-content">
              <div class="form-row">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Doctor Name</mat-label>
                  <input matInput formControlName="name" required>
                  <mat-error *ngIf="doctorForm.get('name')?.hasError('required')">Name is required</mat-error>
                </mat-form-field>
              </div>

              <div class="form-row">
                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>Specialty</mat-label>
                  <mat-select formControlName="specialty" required>
                    <mat-option *ngFor="let specialty of specialties" [value]="specialty">{{ specialty }}</mat-option>
                  </mat-select>
                  <mat-error *ngIf="doctorForm.get('specialty')?.hasError('required')">Specialty is required</mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>Gender</mat-label>
                  <mat-select formControlName="gender">
                    <mat-option *ngFor="let gender of genderOptions" [value]="gender">{{ gender }}</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>

              <div class="form-row">
                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>Email</mat-label>
                  <input matInput formControlName="email" type="email">
                  <mat-error *ngIf="doctorForm.get('email')?.hasError('email')">Please enter a valid email address</mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>Phone</mat-label>
                  <input matInput formControlName="phone">
                </mat-form-field>
              </div>

              <div class="form-row">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Profile Image URL</mat-label>
                  <input matInput formControlName="imageUrl">
                </mat-form-field>
              </div>

              <div class="form-row">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Bio</mat-label>
                  <textarea matInput formControlName="bio" rows="4"></textarea>
                </mat-form-field>
              </div>

              <div class="form-row">
                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>Consultation Cost (â‚¹)</mat-label>
                  <input matInput formControlName="cost" type="number">
                </mat-form-field>
              </div>
            </div>
          </mat-tab>

          <!-- Experience Tab -->
          <mat-tab label="Experience & Fellowship">
            <div class="tab-content">
              <h3>Experience</h3>
              <div class="form-row">
                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>Years of Experience</mat-label>
                  <input matInput formControlName="yearsExperience" type="number">
                </mat-form-field>

                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>Post-Fellowship Years</mat-label>
                  <input matInput formControlName="postFellowshipYears" type="number">
                </mat-form-field>
              </div>

              <h3>Fellowship</h3>
              <div class="form-row">
                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>Fellowship Type</mat-label>
                  <mat-select formControlName="fellowshipType">
                    <mat-option *ngFor="let type of fellowshipTypes" [value]="type">{{ type }}</mat-option>
                  </mat-select>
                </mat-form-field>

                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>Fellowship Details</mat-label>
                  <input matInput formControlName="fellowshipDetails" placeholder="DNB, FNB, country names, etc.">
                </mat-form-field>
              </div>
            </div>
          </mat-tab>

          <!-- Location Tab -->
          <mat-tab label="Location">
            <div class="tab-content">
              <div class="form-row">
                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>State</mat-label>
                  <mat-select formControlName="state">
                    <mat-option *ngFor="let state of states" [value]="state">{{ state }}</mat-option>
                  </mat-select>
                </mat-form-field>

                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>City</mat-label>
                  <mat-select formControlName="city">
                    <mat-option *ngFor="let city of cities[doctorForm.get('state')?.value] || []" [value]="city">{{ city }}</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>

              <div class="form-row checkbox-row">
                <mat-checkbox formControlName="isLocal">Local Doctor</mat-checkbox>
                <mat-checkbox formControlName="isVisiting">Visiting Doctor</mat-checkbox>
              </div>

              <div *ngIf="doctorForm.get('isVisiting')?.value" class="form-row">
                <h4>Visiting Cities</h4>
                <div class="array-container">
                  <div *ngFor="let city of visitingCitiesArray.controls; let i = index" class="array-item">
                    <mat-form-field appearance="outline">
                      <mat-label>City {{ i + 1 }}</mat-label>
                      <input matInput [formControl]="city">
                    </mat-form-field>
                    <button type="button" mat-icon-button color="warn" (click)="removeVisitingCity(i)">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </div>
                  <button type="button" mat-stroked-button color="primary" (click)="addVisitingCity()">
                    <mat-icon>add</mat-icon> Add Visiting City
                  </button>
                </div>
              </div>
            </div>
          </mat-tab>

          <!-- Availability Tab -->
          <mat-tab label="Availability">
            <div class="tab-content">
              <div class="form-row">
                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>Available Next Days</mat-label>
                  <input matInput formControlName="availableNextDays" type="number">
                </mat-form-field>
              </div>

              <div class="form-row checkbox-row">
                <mat-checkbox formControlName="hasWeekendSlots">Has Weekend Slots</mat-checkbox>
              </div>

              <div class="form-row">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Availability Notes</mat-label>
                  <textarea matInput formControlName="availabilityNotes" rows="3"></textarea>
                </mat-form-field>
              </div>
            </div>
          </mat-tab>

          <!-- Surgery & Implants Tab -->
          <mat-tab label="Surgery & Implants">
            <div class="tab-content">
              <h3>Surgery Volume</h3>
              <div class="form-row">
                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>Surgery Count</mat-label>
                  <input matInput formControlName="surgeryCount" type="number">
                </mat-form-field>

                <div class="checkbox-container">
                  <mat-checkbox formControlName="verifiedSurgeryCount">Verified Surgery Count</mat-checkbox>
                </div>
              </div>

              <div class="form-row">
                <h4>Surgery Types</h4>
                <div class="array-container">
                  <div *ngFor="let type of surgeryTypesArray.controls; let i = index" class="array-item">
                    <mat-form-field appearance="outline">
                      <mat-label>Surgery Type {{ i + 1 }}</mat-label>
                      <input matInput [formControl]="type">
                    </mat-form-field>
                    <button type="button" mat-icon-button color="warn" (click)="removeSurgeryType(i)">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </div>
                  <button type="button" mat-stroked-button color="primary" (click)="addSurgeryType()">
                    <mat-icon>add</mat-icon> Add Surgery Type
                  </button>
                </div>
              </div>

              <h3>Implant Preferences</h3>
              <div class="form-row checkbox-row">
                <mat-checkbox formControlName="offersIndianImplants">Offers Indian Implants</mat-checkbox>
                <mat-checkbox formControlName="offersImportedImplants">Offers Imported Implants</mat-checkbox>
              </div>

              <div class="form-row">
                <h4>Implant Preferences</h4>
                <div class="array-container">
                  <div *ngFor="let pref of implantPreferencesArray.controls; let i = index" class="array-item">
                    <mat-form-field appearance="outline">
                      <mat-label>Implant {{ i + 1 }}</mat-label>
                      <input matInput [formControl]="pref">
                    </mat-form-field>
                    <button type="button" mat-icon-button color="warn" (click)="removeImplantPreference(i)">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </div>
                  <button type="button" mat-stroked-button color="primary" (click)="addImplantPreference()">
                    <mat-icon>add</mat-icon> Add Implant Preference
                  </button>
                </div>
              </div>
            </div>
          </mat-tab>

          <!-- Ratings & Academic Tab -->
          <mat-tab label="Ratings & Academic">
            <div class="tab-content">
              <h3>Ratings & Reviews</h3>
              <div class="form-row">
                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>Patient Rating (0-5)</mat-label>
                  <input matInput formControlName="patientRating" type="number" min="0" max="5" step="0.1">
                </mat-form-field>

                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>Review Count</mat-label>
                  <input matInput formControlName="reviewCount" type="number">
                </mat-form-field>
              </div>

              <div class="form-row">
                <h4>External Ratings</h4>
                <div class="array-container">
                  <div *ngFor="let rating of externalRatingsArray.controls; let i = index" class="array-item">
                    <div [formGroup]="$any(rating)" class="rating-group">
                      <mat-form-field appearance="outline">
                        <mat-label>Source</mat-label>
                        <input matInput formControlName="source" placeholder="Google, Practo, etc.">
                      </mat-form-field>
                      <mat-form-field appearance="outline">
                        <mat-label>Rating</mat-label>
                        <input matInput formControlName="rating" type="number" min="0" max="5" step="0.1">
                      </mat-form-field>
                      <mat-form-field appearance="outline">
                        <mat-label>Link</mat-label>
                        <input matInput formControlName="link" placeholder="URL to rating">
                      </mat-form-field>
                      <button type="button" mat-icon-button color="warn" (click)="removeExternalRating(i)">
                        <mat-icon>delete</mat-icon>
                      </button>
                    </div>
                  </div>
                  <button type="button" mat-stroked-button color="primary" (click)="addExternalRating()">
                    <mat-icon>add</mat-icon> Add External Rating
                  </button>
                </div>
              </div>

              <h3>Academic Merit</h3>
              <div class="form-row checkbox-row">
                <mat-checkbox formControlName="hasPublications">Has Publications</mat-checkbox>
                <mat-checkbox formControlName="isSpeaker">Speaker at Events</mat-checkbox>
              </div>

              <div *ngIf="doctorForm.get('hasPublications')?.value" class="form-row">
                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>Publication Count</mat-label>
                  <input matInput formControlName="publicationCount" type="number">
                </mat-form-field>
              </div>

              <div *ngIf="doctorForm.get('isSpeaker')?.value" class="form-row">
                <h4>Speaker Events</h4>
                <div class="array-container">
                  <div *ngFor="let event of speakerEventsArray.controls; let i = index" class="array-item">
                    <mat-form-field appearance="outline">
                      <mat-label>Event {{ i + 1 }}</mat-label>
                      <input matInput [formControl]="event">
                    </mat-form-field>
                    <button type="button" mat-icon-button color="warn" (click)="removeSpeakerEvent(i)">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </div>
                  <button type="button" mat-stroked-button color="primary" (click)="addSpeakerEvent()">
                    <mat-icon>add</mat-icon> Add Speaker Event
                  </button>
                </div>
              </div>

              <div class="form-row">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Academic Notes</mat-label>
                  <textarea matInput formControlName="academicNotes" rows="3"></textarea>
                </mat-form-field>
              </div>
            </div>
          </mat-tab>

          <!-- Languages Tab -->
          <mat-tab label="Languages">
            <div class="tab-content">
              <div class="form-row">
                <h4>Languages Spoken</h4>
                <div class="array-container">
                  <div *ngFor="let lang of languagesArray.controls; let i = index" class="array-item">
                    <mat-form-field appearance="outline">
                      <mat-label>Language {{ i + 1 }}</mat-label>
                      <mat-select [formControl]="lang">
                        <mat-option *ngFor="let language of languages" [value]="language">{{ language }}</mat-option>
                      </mat-select>
                    </mat-form-field>
                    <button type="button" mat-icon-button color="warn" (click)="removeLanguage(i)">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </div>
                  <button type="button" mat-stroked-button color="primary" (click)="addLanguage()">
                    <mat-icon>add</mat-icon> Add Language
                  </button>
                </div>
              </div>
            </div>
          </mat-tab>
        </mat-tab-group>

        <div class="form-actions">
          <button type="button" mat-stroked-button (click)="onCancel()">Cancel</button>
          <button type="submit" mat-raised-button color="primary" [disabled]="doctorForm.invalid || loading">
            {{ isEditMode ? 'Update' : 'Create' }} Doctor
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>
