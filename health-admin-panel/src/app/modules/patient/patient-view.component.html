<div class="patient-journey-container">
  <!-- Page Header -->
  <div class="journey-header">
    <div class="header-content">
      <h1>Patient Journey</h1>
      <p class="subtitle">Find the right care for your needs</p>
    </div>
    <div class="header-actions">
      <div class="user-info" *ngIf="userName">
        <mat-icon>person</mat-icon>
        <span>{{ userName }}</span>
      </div>
    </div>
  </div>
  
  <!-- Search and Filter Bar -->
  <div class="search-filter-bar">
    <div class="results-count">{{ filteredSurgeons.length }} results</div>
    <div class="filter-actions">
      <button mat-button class="clear-btn" (click)="clearAllFilters()" *ngIf="hasActiveFilters()">
        <mat-icon>clear</mat-icon> Clear Filters
      </button>
      <button mat-button class="filter-btn" (click)="toggleFilterSidebar()">
        <mat-icon>filter_list</mat-icon> Filters
      </button>
    </div>
  </div>

  <!-- Journey Progress Steps -->
  <div class="journey-progress">
    <div class="progress-step" [class.active]="currentStepIndex === 0" (click)="stepper.selectedIndex = 0">
      <div class="step-number">1</div>
      <div class="step-label">Select Surgery</div>
    </div>
    <div class="progress-connector"></div>
    <div class="progress-step" [class.active]="currentStepIndex === 1" (click)="stepper.selectedIndex = 1">
      <div class="step-number">2</div>
      <div class="step-label">Select Surgeon</div>
    </div>
    <div class="progress-connector"></div>
    <div class="progress-step" [class.active]="currentStepIndex === 2" (click)="stepper.selectedIndex = 2">
      <div class="step-number">3</div>
      <div class="step-label">Select Implant</div>
    </div>
    <div class="progress-connector"></div>
    <div class="progress-step" [class.active]="currentStepIndex === 3" (click)="stepper.selectedIndex = 3">
      <div class="step-number">4</div>
      <div class="step-label">Select Hospital</div>
    </div>
    <div class="progress-connector"></div>
    <div class="progress-step" [class.active]="currentStepIndex === 4" (click)="stepper.selectedIndex = 4">
      <div class="step-number">5</div>
      <div class="step-label">Summary</div>
    </div>
  </div>

  <div class="journey-content">
    <!-- Main Content -->
    <div class="main-content" [class.with-sidebar]="showFilterSidebar && currentStepIndex === 1">
      <div class="sidebar" *ngIf="showFilterSidebar && currentStepIndex === 1">
        <div class="filter-section">
          <h3>Program Rankings</h3>
          <div class="filter-group">
            <mat-form-field appearance="outline">
              <mat-label>Specialty</mat-label>
              <mat-select [(ngModel)]="filters.fellowshipType" (selectionChange)="applyFilters()">
                <mat-option [value]="null">Any</mat-option>
                <mat-option value="International">International</mat-option>
                <mat-option value="National">National</mat-option>
                <mat-option value="None">None</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>
        
        <div class="filter-section">
          <h3>Location</h3>
          <div class="filter-group">
            <mat-form-field appearance="outline">
              <mat-label>City</mat-label>
              <mat-select [(ngModel)]="filters.city" (selectionChange)="applyFilters()">
                <mat-option [value]="null">Any</mat-option>
                <mat-option *ngFor="let city of cities" [value]="city">{{ city }}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>
        
        <div class="filter-section">
          <h3>Experience</h3>
          <div class="filter-group">
            <mat-form-field appearance="outline">
              <mat-label>Minimum Experience</mat-label>
              <mat-select [(ngModel)]="filters.minExperience" (selectionChange)="applyFilters()">
                <mat-option [value]="null">Any</mat-option>
                <mat-option [value]="5">5+ Years</mat-option>
                <mat-option [value]="10">10+ Years</mat-option>
                <mat-option [value]="15">15+ Years</mat-option>
                <mat-option [value]="20">20+ Years</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>
        
        <div class="filter-section">
          <h3>Availability</h3>
          <div class="filter-group">
            <mat-checkbox [(ngModel)]="filters.hasWeekendSlots" (change)="applyFilters()">Weekend Slots</mat-checkbox>
          </div>
        </div>
      </div>
      
      <!-- Surgery Type Filter Bar -->
      <div class="surgery-type-filter" *ngIf="currentStepIndex === 0">
        <div class="filter-label">Filter by Surgery Type:</div>
        <div class="filter-buttons">
          <button mat-stroked-button [class.active]="surgeryFilters.type === null" (click)="surgeryFilters.type = null; applySurgeryFilters()">
            All Types
          </button>
          <button mat-stroked-button [class.active]="surgeryFilters.type === 'knee'" (click)="surgeryFilters.type = 'knee'; applySurgeryFilters()">
            <mat-icon>accessibility_new</mat-icon> Knee
          </button>
          <button mat-stroked-button [class.active]="surgeryFilters.type === 'hip'" (click)="surgeryFilters.type = 'hip'; applySurgeryFilters()">
            <mat-icon>accessibility</mat-icon> Hip
          </button>
          <button mat-stroked-button [class.active]="surgeryFilters.side === 'left'" (click)="surgeryFilters.side = 'left'; applySurgeryFilters()">
            <mat-icon>arrow_back</mat-icon> Left Side
          </button>
          <button mat-stroked-button [class.active]="surgeryFilters.side === 'right'" (click)="surgeryFilters.side = 'right'; applySurgeryFilters()">
            <mat-icon>arrow_forward</mat-icon> Right Side
          </button>
          <button mat-stroked-button [class.active]="surgeryFilters.isTotal === true" (click)="surgeryFilters.isTotal = true; applySurgeryFilters()">
            Total
          </button>
          <button mat-stroked-button [class.active]="surgeryFilters.isPartial === true" (click)="surgeryFilters.isPartial = true; applySurgeryFilters()">
            Partial
          </button>
          <button mat-stroked-button color="primary" (click)="clearAllSurgeryFilters()" *ngIf="hasSurgeryFilters()">
            <mat-icon>clear_all</mat-icon> Clear Filters
          </button>
        </div>
      </div>
      
      <mat-horizontal-stepper linear #stepper class="journey-stepper">
        <!-- Step 1: Select Surgery Type -->
        <mat-step label="Select Surgery Type">
          <div class="step-content">
            <div class="step-header">
              <h2>Select Surgery Type</h2>
              <button mat-button class="filter-btn" (click)="showFilterSidebar = !showFilterSidebar && currentStepIndex === 0">
                <mat-icon>filter_list</mat-icon> Filters
                <span class="filter-count" *ngIf="getSurgeryFilterCount() > 0">{{ getSurgeryFilterCount() }}</span>
              </button>
            </div>
            
            <!-- Surgery Filters Sidebar -->
            <div class="sidebar surgery-filters" *ngIf="showFilterSidebar && currentStepIndex === 0">
              <div class="filter-header">
                <h3>Filter Surgeries</h3>
                <button mat-icon-button (click)="showFilterSidebar = false">
                  <mat-icon>close</mat-icon>
                </button>
              </div>
              
              <div class="filter-section">
                <h4>Surgery Type</h4>
                <div class="filter-group">
                  <mat-form-field appearance="outline">
                    <mat-label>Joint Type</mat-label>
                    <mat-select [(ngModel)]="surgeryFilters.type" (selectionChange)="applySurgeryFilters()">
                      <mat-option [value]="null">Any</mat-option>
                      <mat-option value="knee">Knee</mat-option>
                      <mat-option value="hip">Hip</mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
              </div>
              
              <div class="filter-section">
                <h4>Side</h4>
                <div class="filter-group">
                  <mat-form-field appearance="outline">
                    <mat-label>Side</mat-label>
                    <mat-select [(ngModel)]="surgeryFilters.side" (selectionChange)="applySurgeryFilters()">
                      <mat-option [value]="null">Any</mat-option>
                      <mat-option value="left">Left</mat-option>
                      <mat-option value="right">Right</mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
              </div>
              
              <div class="filter-section">
                <h4>Surgery Extent</h4>
                <div class="filter-group">
                  <mat-checkbox [(ngModel)]="surgeryFilters.isTotal" (change)="applySurgeryFilters()">Total Replacement</mat-checkbox>
                </div>
                <div class="filter-group">
                  <mat-checkbox [(ngModel)]="surgeryFilters.isPartial" (change)="applySurgeryFilters()">Partial Replacement</mat-checkbox>
                </div>
              </div>
              
              <div class="filter-section">
                <h4>Surgery Type</h4>
                <div class="filter-group">
                  <mat-checkbox [(ngModel)]="surgeryFilters.isReplacement" (change)="applySurgeryFilters()">Primary Replacement</mat-checkbox>
                </div>
                <div class="filter-group">
                  <mat-checkbox [(ngModel)]="surgeryFilters.isRevision" (change)="applySurgeryFilters()">Revision Surgery</mat-checkbox>
                </div>
              </div>
              
              <div class="filter-section">
                <h4>Price Range</h4>
                <div class="filter-group">
                  <mat-form-field appearance="outline">
                    <mat-label>Maximum Price (₹)</mat-label>
                    <mat-select [(ngModel)]="surgeryFilters.maxPrice" (selectionChange)="applySurgeryFilters()">
                      <mat-option [value]="null">Any</mat-option>
                      <mat-option [value]="150000">₹150,000</mat-option>
                      <mat-option [value]="180000">₹180,000</mat-option>
                      <mat-option [value]="200000">₹200,000</mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
              </div>
              
              <div class="filter-actions">
                <button mat-stroked-button color="primary" (click)="clearAllSurgeryFilters()" *ngIf="hasSurgeryFilters()">
                  <mat-icon>clear_all</mat-icon> Clear All Filters
                </button>
              </div>
            </div>
            
            <!-- Results List -->
            <div class="results-list surgery-list">
              <div *ngFor="let surgery of filteredSurgeries" class="result-card" [class.selected]="step1Selection === surgery.id">
                <div class="card-left">
                  <div class="surgery-image">
                    <img [src]="surgery.image || 'assets/images/default-surgery.jpg'" alt="{{ surgery.name }}">
                  </div>
                </div>
                
                <div class="card-middle">
                  <h3 class="surgery-name">{{ surgery.name }}</h3>
                  <p class="surgery-description">{{ surgery.description }}</p>
                  
                  <div class="surgery-tags">
                    <span class="tag">{{ surgery.type === 'knee' ? 'Knee' : 'Hip' }}</span>
                    <span class="tag">{{ surgery.side === 'left' ? 'Left' : 'Right' }}</span>
                    <span class="tag" *ngIf="surgery.isTotal">Total</span>
                    <span class="tag" *ngIf="surgery.isPartial">Partial</span>
                    <span class="tag" *ngIf="surgery.isRevision">Revision</span>
                  </div>
                  
                  <div class="surgery-details">
                    <div class="detail-row">
                      <div class="detail-item">
                        <mat-icon>schedule</mat-icon>
                        <span>Recovery: {{ surgery.recoveryTime }}</span>
                      </div>
                      <div class="detail-item">
                        <mat-icon>trending_up</mat-icon>
                        <span>Success Rate: {{ surgery.successRate }}</span>
                      </div>
                    </div>
                    
                    <div class="detail-row">
                      <div class="detail-item">
                        <mat-icon>healing</mat-icon>
                        <span>Pain Level: {{ surgery.painLevel }}</span>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="card-right">
                  <div class="surgery-stats">
                    <div class="stat-item">
                      <div class="stat-label">SUCCESS RATE</div>
                      <div class="stat-value">{{ surgery.successRate }}</div>
                    </div>
                  </div>
                  
                  <button mat-raised-button color="primary" (click)="selectSurgery(surgery.id)">
                    Select
                  </button>
                </div>
              </div>
            </div>
            
            <div class="action-buttons">
              <div></div> <!-- Empty div for flex spacing -->
              <button mat-raised-button color="primary" matStepperNext [disabled]="!step1Selection">
                <span>Continue</span>
                <mat-icon>arrow_forward</mat-icon>
              </button>
            </div>
          </div>
        </mat-step>

        <!-- Step 2: Select Surgeon -->
        <mat-step [stepControl]="step2FormGroup" label="Select Surgeon">
          <div class="step-content">
            <div class="step-header">
              <button mat-icon-button matStepperPrevious>
                <mat-icon>arrow_back</mat-icon>
              </button>
              <h2>Select Surgeon</h2>
              <button mat-button class="filter-btn" (click)="toggleFilterSidebar()">
                <mat-icon>filter_list</mat-icon> Filters
                <span class="filter-count" *ngIf="getActiveFilterCount() > 0">{{ getActiveFilterCount() }}</span>
              </button>
            </div>
            
            <!-- Surgeon Filters Sidebar -->
            <div class="sidebar" *ngIf="showFilterSidebar && currentStepIndex === 1">
              <div class="filter-header">
                <h3>Filter Surgeons</h3>
                <button mat-icon-button (click)="showFilterSidebar = false">
                  <mat-icon>close</mat-icon>
                </button>
              </div>
              
              <div class="filter-section">
                <h4>Program Rankings</h4>
                <div class="filter-group">
                  <mat-form-field appearance="outline">
                    <mat-label>Fellowship Type</mat-label>
                    <mat-select [(ngModel)]="filters.fellowshipType" (selectionChange)="applyFilters()">
                      <mat-option [value]="null">Any</mat-option>
                      <mat-option value="International">International</mat-option>
                      <mat-option value="National">National</mat-option>
                      <mat-option value="None">None</mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
              </div>
              
              <div class="filter-section">
                <h4>Location</h4>
                <div class="filter-group">
                  <mat-form-field appearance="outline">
                    <mat-label>City</mat-label>
                    <mat-select [(ngModel)]="filters.city" (selectionChange)="applyFilters()">
                      <mat-option [value]="null">Any</mat-option>
                      <mat-option *ngFor="let city of cities" [value]="city">{{ city }}</mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
                <div class="filter-group">
                  <mat-checkbox [(ngModel)]="filters.isLocal" (change)="applyFilters()">Local Doctors Only</mat-checkbox>
                </div>
                <div class="filter-group">
                  <mat-checkbox [(ngModel)]="filters.isVisiting" (change)="applyFilters()">Visiting Doctors Only</mat-checkbox>
                </div>
              </div>
              
              <div class="filter-section">
                <h4>Experience</h4>
                <div class="filter-group">
                  <mat-form-field appearance="outline">
                    <mat-label>Minimum Experience</mat-label>
                    <mat-select [(ngModel)]="filters.minExperience" (selectionChange)="applyFilters()">
                      <mat-option [value]="null">Any</mat-option>
                      <mat-option [value]="5">5+ Years</mat-option>
                      <mat-option [value]="10">10+ Years</mat-option>
                      <mat-option [value]="15">15+ Years</mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
                <div class="filter-group">
                  <mat-form-field appearance="outline">
                    <mat-label>Minimum Surgeries</mat-label>
                    <mat-select [(ngModel)]="filters.minSurgeryCount" (selectionChange)="applyFilters()">
                      <mat-option [value]="null">Any</mat-option>
                      <mat-option [value]="500">500+</mat-option>
                      <mat-option [value]="1000">1000+</mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
              </div>
              
              <div class="filter-section">
                <h4>Implant Options</h4>
                <div class="filter-group">
                  <mat-checkbox [(ngModel)]="filters.offersIndianImplants" (change)="applyFilters()">Offers Indian Implants</mat-checkbox>
                </div>
                <div class="filter-group">
                  <mat-checkbox [(ngModel)]="filters.offersImportedImplants" (change)="applyFilters()">Offers Imported Implants</mat-checkbox>
                </div>
              </div>
              
              <div class="filter-section">
                <h4>Availability</h4>
                <div class="filter-group">
                  <mat-form-field appearance="outline">
                    <mat-label>Available Within</mat-label>
                    <mat-select [(ngModel)]="filters.availableNextDays" (selectionChange)="applyFilters()">
                      <mat-option [value]="null">Any</mat-option>
                      <mat-option [value]="3">3 Days</mat-option>
                      <mat-option [value]="7">7 Days</mat-option>
                      <mat-option [value]="14">14 Days</mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
                <div class="filter-group">
                  <mat-checkbox [(ngModel)]="filters.hasWeekendSlots" (change)="applyFilters()">Weekend Slots Available</mat-checkbox>
                </div>
              </div>
              
              <div class="filter-section">
                <h4>Quality</h4>
                <div class="filter-group">
                  <mat-form-field appearance="outline">
                    <mat-label>Minimum Rating</mat-label>
                    <mat-select [(ngModel)]="filters.minRating" (selectionChange)="applyFilters()">
                      <mat-option [value]="null">Any</mat-option>
                      <mat-option [value]="4.0">4.0+</mat-option>
                      <mat-option [value]="4.5">4.5+</mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
                <div class="filter-group">
                  <mat-checkbox [(ngModel)]="filters.hasPublications" (change)="applyFilters()">Has Published Research</mat-checkbox>
                </div>
              </div>
              
              <div class="filter-section">
                <h4>Languages</h4>
                <div class="filter-group">
                  <mat-form-field appearance="outline">
                    <mat-label>Speaks</mat-label>
                    <mat-select [(ngModel)]="filters.languages" multiple (selectionChange)="applyFilters()">
                      <mat-option *ngFor="let language of languages" [value]="language">{{ language }}</mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
              </div>
              
              <div class="filter-actions">
                <button mat-stroked-button color="primary" (click)="clearAllFilters()" *ngIf="hasActiveFilters()">
                  <mat-icon>clear_all</mat-icon> Clear All Filters
                </button>
              </div>
            </div>
            
            <!-- Results List -->
            <div class="results-list">
              <div *ngFor="let surgeon of filteredSurgeons" class="result-card" [class.selected]="step2Surgeon === surgeon.name">
                <div class="card-left">
                  <div class="tier-badge">🏆 Tier 1</div>
                  <div class="surgeon-avatar">
                    <img [src]="surgeon.avatar || 'assets/images/default-avatar.jpg'" alt="{{ surgeon.name }}">
                  </div>
                </div>
                
                <div class="card-middle">
                  <h3 class="surgeon-name">{{ surgeon.name }}</h3>
                  <p class="surgeon-location">{{ surgeon.hospital }}, {{ surgeon.city }}</p>
                  
                  <div class="surgeon-tags">
                    <span class="tag">{{ surgeon.specialty }}</span>
                    <span class="tag">{{ surgeon.yearsExperience }}+ years</span>
                    <span class="tag" *ngIf="surgeon.fellowshipType">{{ surgeon.fellowshipType }} Fellowship</span>
                  </div>
                  
                  <div class="surgeon-details">
                    <div class="detail-row">
                      <div class="detail-item">
                        <mat-icon>event_available</mat-icon>
                        <span>Available in {{ surgeon.availableNextDays }} days</span>
                      </div>
                      <div class="detail-item">
                        <mat-icon>medical_services</mat-icon>
                        <span>{{ surgeon.surgeryCount }}+ surgeries</span>
                      </div>
                    </div>
                    
                    <div class="detail-row">
                      <div class="detail-item">
                        <div class="stars">
                          <mat-icon *ngFor="let star of [1,2,3,4,5]" [class.filled]="surgeon.rating >= star">star</mat-icon>
                        </div>
                        <span class="review-count">{{ surgeon.reviewCount }} reviews</span>
                      </div>
                      <div class="detail-item" *ngIf="surgeon.hasWeekendSlots">
                        <mat-icon>schedule</mat-icon>
                        <span>Weekend slots available</span>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="card-right">
                  <div class="fees-section">
                    <div class="fee-label">CONSULTATION FEE</div>
                    <div class="fee-amount">₹{{ 1500 + ((surgeon.yearsExperience || 0) * 100) }}</div>
                  </div>
                  
                  <button mat-raised-button color="primary" (click)="selectSurgeon(surgeon.name)">
                    Select
                  </button>
                </div>
              </div>
            </div>
            
            <div class="action-buttons">
              <button mat-stroked-button color="primary" matStepperPrevious>
                <mat-icon>arrow_back</mat-icon>
                <span>Back</span>
              </button>
              <button mat-raised-button color="primary" matStepperNext [disabled]="!step2Surgeon">
                <span>Continue</span>
                <mat-icon>arrow_forward</mat-icon>
              </button>
            </div>
          </div>
        </mat-step>

        <!-- Step 3: Select Implant -->
        <mat-step label="Select Implant">
          <div class="step-header">
            <button mat-icon-button matStepperPrevious>
              <mat-icon>arrow_back</mat-icon>
            </button>
            <h2>Select Implant</h2>
          </div>
          
          <div class="implant-options">
            <mat-card class="option-card" (click)="step3Implant = 'indian'" [ngClass]="{'selected': step3Implant === 'indian'}">
              <h3>Indian Implant</h3>
              <div class="implant-details">
                <div class="detail-item">
                  <mat-icon>check_circle</mat-icon>
                  <span>High Quality</span>
                </div>
                <div class="detail-item">
                  <mat-icon>check_circle</mat-icon>
                  <span>Cost Effective</span>
                </div>
                <div class="detail-item">
                  <mat-icon>check_circle</mat-icon>
                  <span>15+ Year Lifespan</span>
                </div>
              </div>
              <div class="price-tag">₹ 45,000</div>
            </mat-card>
            
            <mat-card class="option-card" (click)="step3Implant = 'imported'" [ngClass]="{'selected': step3Implant === 'imported'}">
              <h3>Imported Implant</h3>
              <div class="implant-details">
                <div class="detail-item">
                  <mat-icon>check_circle</mat-icon>
                  <span>Premium Quality</span>
                </div>
                <div class="detail-item">
                  <mat-icon>check_circle</mat-icon>
                  <span>Advanced Materials</span>
                </div>
                <div class="detail-item">
                  <mat-icon>check_circle</mat-icon>
                  <span>20+ Year Lifespan</span>
                </div>
              </div>
              <div class="price-tag">₹ 125,000</div>
            </mat-card>
          </div>
          
          <div class="action-buttons">
            <button mat-stroked-button color="primary" matStepperPrevious>
              <mat-icon>arrow_back</mat-icon>
              <span>Back</span>
            </button>
            <button mat-raised-button color="primary" matStepperNext [disabled]="!step3Implant">
              <span>Continue</span>
              <mat-icon>arrow_forward</mat-icon>
            </button>
          </div>
        </mat-step>
        
        <!-- Step 4: Select Hospital Zone -->
        <mat-step label="Select Hospital Zone">
          <div class="step-header">
            <button mat-icon-button matStepperPrevious>
              <mat-icon>arrow_back</mat-icon>
            </button>
            <h2>Select Hospital Zone</h2>
          </div>
          
          <div class="zone-selection">
            <div class="zone-options">
              <mat-card class="zone-card" (click)="selectZone('zone-a')" [ngClass]="{'selected': step4Zone === 'Zone A'}">
                <h3>Zone A</h3>
                <p>Northern district with premium facilities</p>
              </mat-card>
              
              <mat-card class="zone-card" (click)="selectZone('zone-b')" [ngClass]="{'selected': step4Zone === 'Zone B'}">
                <h3>Zone B</h3>
                <p>Central district with standard facilities</p>
              </mat-card>
              
              <mat-card class="zone-card" (click)="selectZone('zone-c')" [ngClass]="{'selected': step4Zone === 'Zone C'}">
                <h3>Zone C</h3>
                <p>Eastern district with comprehensive services</p>
              </mat-card>
            </div>
            
            <div class="map-container">
              <h3>Hospital Locations</h3>
              <div id="map" style="height: 300px; width: 100%; border-radius: 8px;"></div>
            </div>
            
            <div *ngIf="selectedZone" class="selected-zone-info">
              <mat-icon>location_on</mat-icon>
              <div>
                <strong>{{ selectedZone.name }} selected</strong>
                <p>{{ selectedZone.description }}</p>
              </div>
            </div>
          </div>
          
          <div class="action-buttons">
            <button mat-stroked-button color="primary" matStepperPrevious>
              <mat-icon>arrow_back</mat-icon>
              <span>Back</span>
            </button>
            <button mat-raised-button color="primary" matStepperNext [disabled]="!step4Zone">
              <span>Continue</span>
              <mat-icon>arrow_forward</mat-icon>
            </button>
          </div>
        </mat-step>

        <!-- Step 5: Summary -->
        <mat-step label="Summary">
          <div class="step-header">
            <button mat-icon-button matStepperPrevious>
              <mat-icon>arrow_back</mat-icon>
            </button>
            <h2>Journey Summary</h2>
          </div>
          
          <!-- Journey Summary Cards -->
          <div class="journey-summary">
            <div class="summary-card">
              <div class="summary-card-header">
                <h3>Surgery Type</h3>
              </div>
              <div class="summary-card-content">
                <p>{{ step1Selection === 'left-tkr' ? 'Total Knee Replacement (Left)' : 
                    step1Selection === 'right-tkr' ? 'Total Knee Replacement (Right)' : 
                    step1Selection === 'partial-left' ? 'Partial Knee Replacement (Left)' : 'Not selected' }}</p>
              </div>
            </div>
            
            <div class="summary-card">
              <div class="summary-card-header">
                <h3>Surgeon</h3>
              </div>
              <div class="summary-card-content">
                <p>{{ step2Surgeon || 'Not selected' }}</p>
              </div>
            </div>
            
            <div class="summary-card">
              <div class="summary-card-header">
                <h3>Implant</h3>
              </div>
              <div class="summary-card-content">
                <p>{{ step3Implant || 'Not selected' }}</p>
              </div>
            </div>
            
            <div class="summary-card">
              <div class="summary-card-header">
                <h3>Hospital Zone</h3>
              </div>
              <div class="summary-card-content">
                <p>{{ step4Zone || 'Not selected' }}</p>
              </div>
            </div>
          </div>
          
          <!-- Cost Estimate -->
          <div class="estimate-container">
            <div *ngIf="step2Surgeon" class="surgeon-name">{{ step2Surgeon }}</div>
            
            <div class="cost">
              <h2>₹ {{ estimate | number }}</h2>
            </div>
            
            <div class="cost-breakdown">
              <h3>Includes:</h3>
              <ul>
                <li>2 days hospital stay</li>
                <li>1 night in ICU</li>
                <li>Surgeon's fee</li>
                <li>Anaesthetist</li>
                <li>Medicines</li>
                <li>Disposables</li>
              </ul>
              
              <p class="disclaimer">*For standard surgery only. Additional costs may apply if complications require extra treatment.</p>
            </div>
          </div>
          
          <div class="action-buttons">
            <button mat-stroked-button color="primary" matStepperPrevious>
              <mat-icon>arrow_back</mat-icon>
              <span>Back</span>
            </button>
            <button mat-raised-button color="accent" (click)="bookAppointment()">
              <mat-icon>calendar_today</mat-icon>
              <span>Book Appointment</span>
            </button>
          </div>
        </mat-step>
      </mat-horizontal-stepper>
    </div>
  </div>
</div>
